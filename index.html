<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Beach Day!</title>

<!-- SVG fallbacks must be defined BEFORE images start loading -->
<script>
(function () {
  /* ── sad dog ──────────────────────────────────────────────────────── */
  var SAD = '<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 200 230">'
    + '<ellipse cx="100" cy="222" rx="58" ry="9" fill="rgba(0,0,0,0.12)"/>'
    /* body */
    + '<ellipse cx="100" cy="178" rx="48" ry="40" fill="#d4a555"/>'
    /* head */
    + '<circle cx="100" cy="108" r="56" fill="#d4a555"/>'
    /* left ear (droopy) */
    + '<path d="M50 85 Q26 108 35 146 Q42 162 57 153 Q72 144 66 114 Q62 93 50 85Z" fill="#b07030"/>'
    /* right ear (droopy) */
    + '<path d="M150 85 Q174 108 165 146 Q158 162 143 153 Q128 144 134 114 Q138 93 150 85Z" fill="#b07030"/>'
    /* muzzle */
    + '<ellipse cx="100" cy="126" rx="32" ry="22" fill="#e8c070"/>'
    /* whites of eyes */
    + '<ellipse cx="76" cy="100" rx="11" ry="10" fill="white"/>'
    + '<ellipse cx="124" cy="100" rx="11" ry="10" fill="white"/>'
    /* pupils */
    + '<ellipse cx="78" cy="102" rx="7" ry="7" fill="#1a1a1a"/>'
    + '<ellipse cx="126" cy="102" rx="7" ry="7" fill="#1a1a1a"/>'
    /* eye shine */
    + '<ellipse cx="81" cy="99" rx="2.5" ry="2.5" fill="white"/>'
    + '<ellipse cx="129" cy="99" rx="2.5" ry="2.5" fill="white"/>'
    /* sad brows (inner corners raised) */
    + '<path d="M65 86 Q75 80 85 85" stroke="#8a5020" stroke-width="4" fill="none" stroke-linecap="round"/>'
    + '<path d="M115 85 Q125 80 135 86" stroke="#8a5020" stroke-width="4" fill="none" stroke-linecap="round"/>'
    /* nose */
    + '<ellipse cx="100" cy="117" rx="9" ry="6" fill="#8a5020"/>'
    /* frown */
    + '<path d="M80 136 Q100 126 120 136" stroke="#8a5020" stroke-width="3.5" fill="none" stroke-linecap="round"/>'
    /* tear */
    + '<path d="M71 110 Q68 118 72 125" stroke="#87ceeb" stroke-width="4" fill="none" stroke-linecap="round"/>'
    /* paws */
    + '<ellipse cx="66" cy="212" rx="24" ry="14" fill="#c09040"/>'
    + '<ellipse cx="134" cy="212" rx="24" ry="14" fill="#c09040"/>'
    + '<path d="M58 211 Q66 205 74 211" stroke="#a07030" stroke-width="2" fill="none"/>'
    + '<path d="M126 211 Q134 205 142 211" stroke="#a07030" stroke-width="2" fill="none"/>'
    + '</svg>';

  /* ── sun cream ────────────────────────────────────────────────────── */
  var CREAM = '<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 90 130">'
    /* cap */
    + '<rect x="27" y="5" width="36" height="26" rx="7" fill="#ff9535"/>'
    + '<rect x="21" y="27" width="48" height="9" rx="3" fill="#d07010"/>'
    /* tube body */
    + '<rect x="21" y="34" width="48" height="82" rx="10" fill="white" stroke="#ddd" stroke-width="1.5"/>'
    /* label area */
    + '<rect x="26" y="48" width="38" height="52" rx="5" fill="#fffce8"/>'
    /* sun center */
    + '<circle cx="45" cy="66" r="10" fill="#f7c948"/>'
    /* sun rays */
    + '<line x1="45" y1="51" x2="45" y2="46" stroke="#f7c948" stroke-width="3" stroke-linecap="round"/>'
    + '<line x1="45" y1="86" x2="45" y2="81" stroke="#f7c948" stroke-width="3" stroke-linecap="round"/>'
    + '<line x1="30" y1="66" x2="25" y2="66" stroke="#f7c948" stroke-width="3" stroke-linecap="round"/>'
    + '<line x1="65" y1="66" x2="60" y2="66" stroke="#f7c948" stroke-width="3" stroke-linecap="round"/>'
    + '<line x1="33" y1="55" x2="29" y2="51" stroke="#f7c948" stroke-width="2.5" stroke-linecap="round"/>'
    + '<line x1="57" y1="55" x2="61" y2="51" stroke="#f7c948" stroke-width="2.5" stroke-linecap="round"/>'
    + '<line x1="33" y1="77" x2="29" y2="81" stroke="#f7c948" stroke-width="2.5" stroke-linecap="round"/>'
    + '<line x1="57" y1="77" x2="61" y2="81" stroke="#f7c948" stroke-width="2.5" stroke-linecap="round"/>'
    /* SPF text */
    + '<text x="45" y="90" font-size="9" text-anchor="middle" font-family="Arial,sans-serif" font-weight="bold" fill="#d07010">SPF 50</text>'
    /* rounded bottom */
    + '<ellipse cx="45" cy="116" rx="24" ry="7" fill="#f0f0f0" stroke="#ddd" stroke-width="1"/>'
    + '</svg>';

  /* ── swim ring ────────────────────────────────────────────────────── */
  var RING = '<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 110 110">'
    /* four coloured quadrant sectors */
    /* top-right: yellow */
    + '<path d="M55 55 L55 5 A50 50 0 0 1 105 55 Z" fill="#f7c948"/>'
    /* bottom-right: blue */
    + '<path d="M55 55 L105 55 A50 50 0 0 1 55 105 Z" fill="#3498db"/>'
    /* bottom-left: yellow */
    + '<path d="M55 55 L55 105 A50 50 0 0 1 5 55 Z" fill="#f7c948"/>'
    /* top-left: red */
    + '<path d="M55 55 L5 55 A50 50 0 0 1 55 5 Z" fill="#e74c3c"/>'
    /* inner hole – pale blue so it looks like water */
    + '<circle cx="55" cy="55" r="24" fill="#87d8f0"/>'
    /* divider lines */
    + '<line x1="55" y1="5" x2="55" y2="105" stroke="rgba(255,255,255,0.55)" stroke-width="2"/>'
    + '<line x1="5" y1="55" x2="105" y2="55" stroke="rgba(255,255,255,0.55)" stroke-width="2"/>'
    /* outer border */
    + '<circle cx="55" cy="55" r="50" fill="none" stroke="rgba(0,0,0,0.12)" stroke-width="2"/>'
    /* inner border */
    + '<circle cx="55" cy="55" r="24" fill="none" stroke="rgba(0,0,0,0.12)" stroke-width="1.5"/>'
    /* highlight */
    + '<ellipse cx="37" cy="21" rx="9" ry="5" fill="rgba(255,255,255,0.45)" transform="rotate(-38,37,21)"/>'
    + '</svg>';

  function toURI(svg) {
    return 'data:image/svg+xml,' + encodeURIComponent(svg);
  }

  window._fb = {
    sadDog:   toURI(SAD),
    sunCream: toURI(CREAM),
    swimRing: toURI(RING)
  };

  window._setFB = function (img, key) {
    img.onerror = null;
    img.src = window._fb[key];
  };
}());
</script>

<style>
* { margin: 0; padding: 0; box-sizing: border-box; }

body {
  overflow: hidden;
  width: 100vw;
  height: 100vh;
  font-family: 'Segoe UI', Tahoma, sans-serif;
}

#stage {
  position: relative;
  width: 100vw;
  height: 100vh;
  background: url('beach.png') center / cover no-repeat;
  overflow: hidden;
}

/* ── HUD ────────────────────────────────────────── */
#hud {
  position: absolute;
  top: 16px;
  left: 50%;
  transform: translateX(-50%);
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 6px;
  z-index: 100;
  background: rgba(255, 255, 255, 0.82);
  border-radius: 22px;
  padding: 9px 24px 11px;
  box-shadow: 0 2px 14px rgba(0,0,0,0.2);
  white-space: nowrap;
}

#progressText {
  font-size: 14px;
  font-weight: 700;
  color: #444;
  letter-spacing: 1.5px;
  text-transform: uppercase;
}

#progressBar {
  width: 180px;
  height: 11px;
  background: #ddd;
  border-radius: 6px;
  overflow: hidden;
}

#progressFill {
  height: 100%;
  width: 0%;
  background: linear-gradient(90deg, #f7c948, #f0923c);
  border-radius: 6px;
  transition: width 0.45s cubic-bezier(0.4, 0, 0.2, 1);
}

/* ── Dog container ──────────────────────────────── */
#dogContainer {
  position: absolute;
  bottom: 20%;
  left: 50%;
  transform: translateX(-50%);
  width: clamp(180px, 22vw, 260px);
  height: clamp(180px, 22vw, 260px);
}

#dogSad, #dogHappy {
  position: absolute;
  top: 0; left: 0;
  width: 100%; height: 100%;
  object-fit: contain;
  transition: opacity 0.65s ease;
}

#dogHappy { opacity: 0; }

/* ── Equipped overlays ──────────────────────────── */
#equipJuice {
  position: absolute;
  width: 30%;
  left: -14%;
  bottom: 22%;
  opacity: 0;
  object-fit: contain;
  transition: opacity 0.35s ease;
  pointer-events: none;
}

#equipSunCream {
  position: absolute;
  width: 25%;
  right: -12%;
  top: 22%;
  opacity: 0;
  object-fit: contain;
  transition: opacity 0.35s ease;
  pointer-events: none;
}

#equipSwimRing {
  position: absolute;
  width: 110%;
  left: 50%;
  transform: translateX(-50%);
  bottom: -12%;
  opacity: 0;
  object-fit: contain;
  transition: opacity 0.35s ease;
  pointer-events: none;
}

/* ── Sad cloud ──────────────────────────────────── */
#sadCloud {
  position: absolute;
  top: -18%;
  left: 50%;
  transform: translateX(-50%);
  transition: opacity 0.55s ease;
  animation: cloudFloat 2.2s ease-in-out infinite;
  pointer-events: none;
}

@keyframes cloudFloat {
  0%, 100% { transform: translateX(-50%) translateY(0px); }
  50%       { transform: translateX(-50%) translateY(-8px); }
}

/* ── Sand items ─────────────────────────────────── */
.sand-item {
  position: absolute;
  width:  clamp(95px, 11vw, 130px);
  height: clamp(95px, 11vw, 130px);
  cursor: pointer;
  user-select: none;
  transition: opacity 0.3s ease;
}

.sand-item img,
.sand-item svg {
  width: 100%;
  height: 100%;
  object-fit: contain;
  pointer-events: none;
  transition: transform 0.18s ease, filter 0.2s ease;
  display: block;
}

.sand-item:hover:not(.used) img,
.sand-item:hover:not(.used) svg {
  filter: drop-shadow(0 0 12px rgba(255, 220, 0, 1)) drop-shadow(0 0 5px rgba(255, 180, 0, 0.8));
  transform: scale(1.1);
}

.sand-item.used {
  opacity: 0.35;
  pointer-events: none;
}

/* Checkmark badge */
.checkmark {
  position: absolute;
  top: -10px;
  right: -10px;
  width: 28px;
  height: 28px;
  background: #27ae60;
  border: 2.5px solid #fff;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 15px;
  color: white;
  line-height: 1;
  opacity: 0;
  transform: scale(0);
  transition: opacity 0.2s ease, transform 0.38s cubic-bezier(0.68, -0.55, 0.27, 1.55);
  z-index: 10;
}

.checkmark.shown {
  opacity: 1;
  transform: scale(1);
}

/* Item positions */
#itemJuice    { bottom: 20%; left: 14%; }
#itemSunCream { bottom: 18%; left: 50%; transform: translateX(-50%); }
#itemSwimRing { bottom: 20%; right: 14%; }

/* ── Hint text ──────────────────────────────────── */
#hintText {
  position: absolute;
  bottom: 14%;
  left: 50%;
  transform: translateX(-50%);
  background: rgba(210, 50, 50, 0.9);
  color: #fff;
  padding: 7px 20px;
  border-radius: 22px;
  font-size: 15px;
  font-weight: 700;
  letter-spacing: 0.5px;
  opacity: 0;
  pointer-events: none;
  z-index: 50;
  white-space: nowrap;
  transition: opacity 0.3s ease;
}

/* ── Star burst ─────────────────────────────────── */
#starBurst {
  position: absolute;
  top: -42%;
  left: 50%;
  transform: translateX(-50%);
  width: 140%;
  height: 110px;
  pointer-events: none;
}

.star {
  position: absolute;
  clip-path: polygon(50% 0%,61% 35%,98% 35%,68% 57%,79% 91%,50% 70%,21% 91%,32% 57%,2% 35%,39% 35%);
  animation: starPop 0.95s ease-out forwards;
  opacity: 0;
}

@keyframes starPop {
  0%   { transform: scale(0) rotate(0deg);   opacity: 0; }
  35%  { opacity: 1; transform: scale(1.6) rotate(160deg); }
  100% { transform: scale(0.3) rotate(340deg) translateY(-28px); opacity: 0; }
}

/* ── Shake ──────────────────────────────────────── */
@keyframes shake {
  0%,100% { transform: translateX(0) rotate(0deg); }
  14%      { transform: translateX(-10px) rotate(-4deg); }
  28%      { transform: translateX(10px)  rotate(4deg); }
  42%      { transform: translateX(-7px) rotate(-2deg); }
  57%      { transform: translateX(7px)  rotate(2deg); }
  71%      { transform: translateX(-3px); }
  85%      { transform: translateX(3px); }
}

@keyframes shakeCentered {
  0%,100% { transform: translateX(-50%) rotate(0deg); }
  14%      { transform: translateX(calc(-50% - 10px)) rotate(-4deg); }
  28%      { transform: translateX(calc(-50% + 10px)) rotate(4deg); }
  42%      { transform: translateX(calc(-50% - 7px)) rotate(-2deg); }
  57%      { transform: translateX(calc(-50% + 7px)) rotate(2deg); }
  71%      { transform: translateX(calc(-50% - 3px)); }
  85%      { transform: translateX(calc(-50% + 3px)); }
}

.shake         { animation: shake 0.52s ease !important; }
.shakeCentered { animation: shakeCentered 0.52s ease !important; }

/* ── Splash ─────────────────────────────────────── */
.splash-drop {
  position: absolute;
  border-radius: 50%;
  background: rgba(100, 200, 255, 0.78);
  animation: splashPop 0.8s ease-out forwards;
}

@keyframes splashPop {
  0%   { transform: scale(0);   opacity: 0.9; }
  55%  { opacity: 0.6; }
  100% { transform: scale(3.5); opacity: 0; }
}

/* ── Dog bob ────────────────────────────────────── */
@keyframes dogBob {
  0%,100% { transform: translateX(-50%) translateY(0px); }
  50%     { transform: translateX(-50%) translateY(-10px); }
}

/* ── End overlay ────────────────────────────────── */
#endOverlay {
  position: absolute;
  inset: 0;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  background: rgba(0, 80, 190, 0.3);
  opacity: 0;
  pointer-events: none;
  transition: opacity 0.9s ease;
  z-index: 300;
}

#endOverlay.visible {
  opacity: 1;
  pointer-events: all;
}

#endOverlay h1 {
  font-size: clamp(28px, 6vw, 58px);
  color: #fff;
  text-shadow: 0 3px 14px rgba(0,0,0,0.5);
  letter-spacing: 4px;
  animation: bounceIn 0.7s cubic-bezier(0.68,-0.55,0.27,1.55) both;
}

#endOverlay .end-sub {
  font-size: clamp(14px, 3vw, 24px);
  color: rgba(255,255,255,0.92);
  margin-top: 12px;
  text-shadow: 0 1px 6px rgba(0,0,0,0.3);
}

#endOverlay .restart-hint {
  margin-top: 22px;
  font-size: clamp(11px, 1.8vw, 15px);
  color: rgba(255,255,255,0.5);
  letter-spacing: 0.5px;
}

@keyframes bounceIn {
  0%  { transform: scale(0.4); opacity: 0; }
  60% { transform: scale(1.12); }
  100%{ transform: scale(1);    opacity: 1; }
}
</style>
</head>
<body>
<div id="stage">

  <!-- HUD -->
  <div id="hud">
    <div id="progressText">PREP: 0 / 3</div>
    <div id="progressBar"><div id="progressFill"></div></div>
  </div>

  <!-- ── Sand items ── -->
  <div id="itemJuice" class="sand-item">
    <img src="juice.png" alt="Juice">
    <div class="checkmark">&#10003;</div>
  </div>

  <div id="itemSunCream" class="sand-item">
    <!-- sun-cream.png is empty; onerror swaps in SVG fallback -->
    <img src="sun-cream.png" onerror="_setFB(this,'sunCream')" alt="Sun Cream">
    <div class="checkmark">&#10003;</div>
  </div>

  <div id="itemSwimRing" class="sand-item">
    <!-- swim-ring.png is empty; onerror swaps in SVG fallback -->
    <img src="swim-ring.png" onerror="_setFB(this,'swimRing')" alt="Swim Ring">
    <div class="checkmark">&#10003;</div>
  </div>

  <!-- ── Dog container ── -->
  <div id="dogContainer">

    <!-- sad-dog.png is empty; onerror swaps in SVG sad-dog -->
    <img id="dogSad"   src="sad-dog.png"           onerror="_setFB(this,'sadDog')" alt="Sad Dog">
    <!-- use the real valid PNG for happy dog -->
    <img id="dogHappy" src="dog with swim ring.png" alt="Happy Dog">

    <!-- Equipped overlays -->
    <img id="equipJuice"    src="juice.png"     alt="">
    <img id="equipSunCream" src="sun-cream.png" onerror="_setFB(this,'sunCream')" alt="">
    <img id="equipSwimRing" src="swim-ring.png" onerror="_setFB(this,'swimRing')" alt="">

    <!-- Sad cloud SVG -->
    <div id="sadCloud">
      <svg width="80" height="48" viewBox="0 0 80 48" fill="none" xmlns="http://www.w3.org/2000/svg">
        <ellipse cx="40" cy="36" rx="32" ry="14" fill="#aaa" opacity="0.65"/>
        <ellipse cx="24" cy="29" rx="16" ry="11" fill="#bbb" opacity="0.7"/>
        <ellipse cx="54" cy="28" rx="14" ry="10" fill="#bbb" opacity="0.7"/>
        <ellipse cx="40" cy="22" rx="18" ry="13" fill="#ccc" opacity="0.78"/>
      </svg>
    </div>

    <!-- Star burst -->
    <div id="starBurst"></div>

  </div><!-- /dogContainer -->

  <!-- Splash anchor (positioned by JS) -->
  <div id="splash" style="position:fixed;pointer-events:none;z-index:160;"></div>

  <!-- Hint text -->
  <div id="hintText">Not yet!</div>

  <!-- End overlay -->
  <div id="endOverlay">
    <h1>READY TO SWIM!</h1>
    <p class="end-sub">dog: happy</p>
    <p class="restart-hint">click anywhere to restart</p>
  </div>

</div><!-- #stage -->

<script>
(function () {
  'use strict';

  // ── State ─────────────────────────────────────────────────────────
  let step     = 0;
  let busy     = false;
  let endShown = false;
  let hintTimer = null;

  // ── Elements ──────────────────────────────────────────────────────
  const dogContainer = document.getElementById('dogContainer');
  const dogSad       = document.getElementById('dogSad');
  const dogHappy     = document.getElementById('dogHappy');
  const sadCloud     = document.getElementById('sadCloud');
  const starBurst    = document.getElementById('starBurst');
  const hintText     = document.getElementById('hintText');
  const endOverlay   = document.getElementById('endOverlay');
  const splash       = document.getElementById('splash');
  const progressText = document.getElementById('progressText');
  const progressFill = document.getElementById('progressFill');

  const itemJuice    = document.getElementById('itemJuice');
  const itemSunCream = document.getElementById('itemSunCream');
  const itemSwimRing = document.getElementById('itemSwimRing');
  const equipJuice   = document.getElementById('equipJuice');
  const equipSunCream= document.getElementById('equipSunCream');
  const equipSwimRing= document.getElementById('equipSwimRing');

  const ITEMS = [
    { el: itemJuice,    equip: equipJuice,    stepIdx: 0, centered: false },
    { el: itemSunCream, equip: equipSunCream,  stepIdx: 1, centered: true  },
    { el: itemSwimRing, equip: equipSwimRing,  stepIdx: 2, centered: false },
  ];

  // ── Init ──────────────────────────────────────────────────────────
  function init() {
    ITEMS.forEach(item => item.el.addEventListener('click', () => onItemClick(item)));
    endOverlay.addEventListener('click', restart);
  }

  // ── Click ─────────────────────────────────────────────────────────
  function onItemClick(item) {
    if (busy || endShown) return;
    if (item.el.classList.contains('used')) return;
    if (item.stepIdx === step) applyItem(item);
    else                       wrongItem(item);
  }

  // ── Wrong order ───────────────────────────────────────────────────
  function wrongItem(item) {
    item.el.classList.remove('shake', 'shakeCentered');
    void item.el.offsetWidth;
    item.el.classList.add(item.centered ? 'shakeCentered' : 'shake');
    setTimeout(() => item.el.classList.remove('shake', 'shakeCentered'), 560);

    if (hintTimer) clearTimeout(hintTimer);
    hintText.style.opacity = '1';
    hintTimer = setTimeout(() => { hintText.style.opacity = '0'; }, 1500);
  }

  // ── Apply correct item ────────────────────────────────────────────
  function applyItem(item) {
    busy = true;
    flyToDog(item, () => {
      item.equip.style.opacity = '1';
      item.el.classList.add('used');
      item.el.querySelector('.checkmark').classList.add('shown');
      step++;
      updateHUD();
      busy = false;
      if (step === 3) setTimeout(completeAll, 420);
    });
  }

  // ── Fly animation ─────────────────────────────────────────────────
  function flyToDog(item, cb) {
    const fromRect = item.el.getBoundingClientRect();
    const dogRect  = dogContainer.getBoundingClientRect();

    // Get source image (which may now be a data-URI SVG after onerror)
    const imgEl = item.el.querySelector('img');
    const clone = document.createElement('img');
    clone.src   = imgEl.currentSrc || imgEl.src;

    const startX = fromRect.left + fromRect.width  / 2 - 38;
    const startY = fromRect.top  + fromRect.height / 2 - 38;

    clone.style.cssText = [
      'position:fixed',
      'width:76px', 'height:76px',
      'object-fit:contain',
      'pointer-events:none',
      'z-index:500',
      'left:' + startX + 'px',
      'top:'  + startY + 'px',
      'transition:left .65s cubic-bezier(.25,.46,.45,.94),'
                + 'top .65s cubic-bezier(.25,.46,.45,.94),'
                + 'transform .65s ease,'
                + 'opacity .18s ease .54s',
    ].join(';');
    document.body.appendChild(clone);

    const tx = dogRect.left + dogRect.width  / 2 - 38;
    const ty = dogRect.top  + dogRect.height / 2 - 38;

    requestAnimationFrame(() => requestAnimationFrame(() => {
      clone.style.left      = tx + 'px';
      clone.style.top       = ty + 'px';
      clone.style.transform = 'scale(0.5)';
      clone.style.opacity   = '0';
    }));

    setTimeout(() => { document.body.removeChild(clone); cb(); }, 800);
  }

  // ── HUD ───────────────────────────────────────────────────────────
  function updateHUD() {
    progressText.textContent = 'PREP: ' + step + ' / 3';
    progressFill.style.width = (step / 3 * 100) + '%';
  }

  // ── All 3 applied ─────────────────────────────────────────────────
  function completeAll() {
    busy = true;
    sadCloud.style.opacity = '0';
    fireStars();
    setTimeout(() => {
      dogSad.style.opacity   = '0';
      dogHappy.style.opacity = '1';
      setTimeout(moveDogToOcean, 900);
    }, 1100);
  }

  // ── Stars ─────────────────────────────────────────────────────────
  function fireStars() {
    starBurst.innerHTML = '';
    const pal  = ['#FFD700','#FF6B6B','#7ECEF6','#98FB98','#FF69B4','#FFA500'];
    const spots = [
      '8% 50%','25% 12%','50% 55%','74% 10%','92% 48%',
      '18% 82%','50% 0%','82% 80%'
    ];
    spots.forEach((pos, i) => {
      const [l, t] = pos.split(' ');
      const s = document.createElement('div');
      s.className = 'star';
      s.style.cssText = 'left:' + l + ';top:' + t
        + ';width:' + (9 + (i % 4) * 3) + 'px'
        + ';height:' + (9 + (i % 4) * 3) + 'px'
        + ';background:' + pal[i % pal.length]
        + ';animation-delay:' + (i * 0.09) + 's';
      starBurst.appendChild(s);
    });
    setTimeout(() => { starBurst.innerHTML = ''; }, 2400);
  }

  // ── Move dog to ocean ─────────────────────────────────────────────
  function moveDogToOcean() {
    dogContainer.style.transition = 'bottom 1.6s cubic-bezier(.4,0,.2,1)';
    dogContainer.style.bottom = '58%';
    setTimeout(() => {
      showSplash();
      setTimeout(() => {
        dogContainer.style.transition = 'none';
        dogContainer.style.animation  = 'dogBob 1.6s ease-in-out infinite';
        showEndScreen();
      }, 900);
    }, 1650);
  }

  // ── Splash ────────────────────────────────────────────────────────
  function showSplash() {
    const r  = dogContainer.getBoundingClientRect();
    const cx = r.left + r.width / 2;
    const cy = r.bottom - r.height * 0.22;

    Object.assign(splash.style, {
      left:   (cx - 65) + 'px',
      top:    (cy - 32) + 'px',
      width:  '130px',
      height: '65px',
      opacity:'1',
    });
    splash.innerHTML = '';

    [
      [10, 42, 19, 0],    [30, 0,  26, 0.07],
      [50, 52, 21, 0.04], [65, 5,  32, 0.1 ],
      [82, 38, 17, 0.03], [44,-22, 23, 0.06],
    ].forEach(([l, t, sz, d]) => {
      const dr = document.createElement('div');
      dr.className = 'splash-drop';
      dr.style.cssText = 'left:' + l + '%;top:' + t + '%;width:' + sz + 'px;height:' + sz + 'px;animation-delay:' + d + 's';
      splash.appendChild(dr);
    });

    setTimeout(() => { splash.innerHTML = ''; }, 1400);
  }

  // ── End screen ────────────────────────────────────────────────────
  function showEndScreen() {
    endShown = true;
    busy     = false;
    endOverlay.classList.add('visible');
  }

  // ── Restart ───────────────────────────────────────────────────────
  function restart() {
    step     = 0;
    busy     = false;
    endShown = false;

    updateHUD();
    endOverlay.classList.remove('visible');

    dogContainer.style.transition = 'none';
    dogContainer.style.animation  = 'none';
    dogContainer.style.bottom     = '20%';
    dogContainer.style.left       = '50%';
    dogSad.style.opacity   = '1';
    dogHappy.style.opacity = '0';

    sadCloud.style.opacity = '1';
    starBurst.innerHTML    = '';

    if (hintTimer) clearTimeout(hintTimer);
    hintText.style.opacity = '0';
    splash.innerHTML       = '';

    ITEMS.forEach(item => {
      item.el.classList.remove('used', 'shake', 'shakeCentered');
      item.el.querySelector('.checkmark').classList.remove('shown');
      item.equip.style.opacity = '0';
    });
  }

  init();
}());
</script>
</body>
</html>
