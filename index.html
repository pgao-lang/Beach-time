<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Beach Day!</title>

<style>
* { margin: 0; padding: 0; box-sizing: border-box; }

body {
  overflow: hidden;
  width: 100vw;
  height: 100vh;
  font-family: 'Segoe UI', Tahoma, sans-serif;
}

#stage {
  position: relative;
  width: 100vw;
  height: 100vh;
  background: url('beach.png') center / cover no-repeat;
  overflow: hidden;
}

/* ── HUD ────────────────────────────────────────── */
#hud {
  position: absolute;
  top: 16px;
  left: 50%;
  transform: translateX(-50%);
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 6px;
  z-index: 100;
  background: rgba(255, 255, 255, 0.82);
  border-radius: 22px;
  padding: 9px 24px 11px;
  box-shadow: 0 2px 14px rgba(0,0,0,0.2);
  white-space: nowrap;
}

#progressText {
  font-size: 14px;
  font-weight: 700;
  color: #444;
  letter-spacing: 1.5px;
  text-transform: uppercase;
}

#progressBar {
  width: 180px;
  height: 11px;
  background: #ddd;
  border-radius: 6px;
  overflow: hidden;
}

#progressFill {
  height: 100%;
  width: 0%;
  background: linear-gradient(90deg, #f7c948, #f0923c);
  border-radius: 6px;
  transition: width 0.45s cubic-bezier(0.4, 0, 0.2, 1);
}

/* ── Dog container ──────────────────────────────── */
#dogContainer {
  position: absolute;
  bottom: 18%;
  left: 50%;
  transform: translateX(-50%);
  width: clamp(360px, 46vw, 580px);
  height: clamp(360px, 46vw, 580px);
}

#dogSad, #dogJuice, #dogJuiceCream, #dogHappy {
  position: absolute;
  top: 0; left: 0;
  width: 100%; height: 100%;
  object-fit: contain;
  transition: opacity 0.65s ease;
}

#dogJuice,
#dogJuiceCream,
#dogHappy { opacity: 0; }

/* ── Equipped overlays ──────────────────────────── */
#equipJuice {
  position: absolute;
  width: 30%;
  left: -14%;
  bottom: 22%;
  opacity: 0;
  object-fit: contain;
  transition: opacity 0.35s ease;
  pointer-events: none;
}

#equipSunCream {
  position: absolute;
  width: 25%;
  right: -12%;
  top: 22%;
  opacity: 0;
  object-fit: contain;
  transition: opacity 0.35s ease;
  pointer-events: none;
}

#equipSwimRing {
  position: absolute;
  width:  clamp(120px, 15vw, 190px);
  height: clamp(120px, 15vw, 190px);
  bottom: 57%;
  left: 62%;
  opacity: 0;
  object-fit: contain;
  transition: opacity 0.6s ease;
  pointer-events: none;
}

#equipSwimRing.floating {
  animation: swimRingBob 2.4s ease-in-out infinite;
}

@keyframes swimRingBob {
  0%, 100% { transform: translateY(0px)   rotate(-4deg); }
  50%       { transform: translateY(-10px) rotate(4deg); }
}

/* ── Sad cloud ──────────────────────────────────── */
#sadCloud {
  position: absolute;
  top: -18%;
  left: 50%;
  transform: translateX(-50%);
  transition: opacity 0.55s ease;
  animation: cloudFloat 2.2s ease-in-out infinite;
  pointer-events: none;
}

@keyframes cloudFloat {
  0%, 100% { transform: translateX(-50%) translateY(0px); }
  50%       { transform: translateX(-50%) translateY(-8px); }
}

/* ── Sand items ─────────────────────────────────── */
.sand-item {
  position: absolute;
  width:  clamp(130px, 17vw, 210px);
  height: clamp(130px, 17vw, 210px);
  cursor: pointer;
  user-select: none;
  transition: opacity 0.3s ease;
}

.sand-item img,
.sand-item svg {
  width: 100%;
  height: 100%;
  object-fit: contain;
  pointer-events: none;
  transition: transform 0.18s ease, filter 0.2s ease;
  display: block;
}

.sand-item:hover:not(.used) img,
.sand-item:hover:not(.used) svg {
  filter: drop-shadow(0 0 12px rgba(255, 220, 0, 1)) drop-shadow(0 0 5px rgba(255, 180, 0, 0.8));
  transform: scale(1.1);
}

.sand-item.used {
  opacity: 0.35;
  pointer-events: none;
}

/* Checkmark badge */
.checkmark {
  position: absolute;
  top: -10px;
  right: -10px;
  width: 28px;
  height: 28px;
  background: #27ae60;
  border: 2.5px solid #fff;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 15px;
  color: white;
  line-height: 1;
  opacity: 0;
  transform: scale(0);
  transition: opacity 0.2s ease, transform 0.38s cubic-bezier(0.68, -0.55, 0.27, 1.55);
  z-index: 10;
}

.checkmark.shown {
  opacity: 1;
  transform: scale(1);
}

/* Sun-cream & swim-ring are larger than juice */
#itemSunCream,
#itemSwimRing {
  width:  clamp(190px, 24vw, 300px);
  height: clamp(190px, 24vw, 300px);
}

/* Item positions — side items pushed to 5% to clear the wider dog */
#itemJuice    { bottom: 20%; left: 5%; }
#itemSunCream { bottom: 4%;  left: 50%; transform: translateX(-50%); }
#itemSwimRing { bottom: 20%; right: 5%; }

/* Glow the dog when a dragged item is hovering over it */
#dogContainer.drop-glow {
  filter: drop-shadow(0 0 24px rgba(255, 220, 0, 1))
          drop-shadow(0 0 10px rgba(255, 180, 0, 0.85));
}

/* ── Dog speech bubble ───────────────────────────── */
#dogBubble {
  position: absolute;
  top: 8%;
  left: 54%;
  background: #fff;
  color: #333;
  padding: 8px 16px;
  border-radius: 18px;
  font-size: clamp(11px, 1.5vw, 14px);
  font-weight: 700;
  white-space: nowrap;
  box-shadow: 0 3px 14px rgba(0,0,0,0.2);
  pointer-events: none;
  z-index: 90;
  opacity: 0;
}

/* tail pointing left toward the dog */
#dogBubble::after {
  content: '';
  position: absolute;
  left: -10px;
  top: 50%;
  transform: translateY(-50%);
  border-top: 8px solid transparent;
  border-bottom: 8px solid transparent;
  border-right: 11px solid #fff;
}

#dogBubble.visible {
  animation:
    bubblePop   0.4s cubic-bezier(0.68,-0.55,0.27,1.55) forwards,
    bubbleFloat 2.5s 0.4s ease-in-out infinite;
}

@keyframes bubblePop {
  0%   { opacity: 0; transform: scale(0.5); }
  70%  { transform: scale(1.08); }
  100% { opacity: 1; transform: scale(1); }
}

@keyframes bubbleFloat {
  0%, 100% { transform: translateY(0px); }
  50%       { transform: translateY(-5px); }
}

/* ── Hint text ──────────────────────────────────── */
#hintText {
  position: absolute;
  bottom: 17%;
  left: 50%;
  transform: translateX(-50%);
  background: rgba(210, 50, 50, 0.9);
  color: #fff;
  padding: 7px 20px;
  border-radius: 22px;
  font-size: 15px;
  font-weight: 700;
  letter-spacing: 0.5px;
  opacity: 0;
  pointer-events: none;
  z-index: 50;
  white-space: nowrap;
  transition: opacity 0.3s ease;
}

/* ── Star burst ─────────────────────────────────── */
#starBurst {
  position: absolute;
  top: -42%;
  left: 50%;
  transform: translateX(-50%);
  width: 140%;
  height: 110px;
  pointer-events: none;
}

.star {
  position: absolute;
  clip-path: polygon(50% 0%,61% 35%,98% 35%,68% 57%,79% 91%,50% 70%,21% 91%,32% 57%,2% 35%,39% 35%);
  animation: starPop 0.95s ease-out forwards;
  opacity: 0;
}

@keyframes starPop {
  0%   { transform: scale(0) rotate(0deg);   opacity: 0; }
  35%  { opacity: 1; transform: scale(1.6) rotate(160deg); }
  100% { transform: scale(0.3) rotate(340deg) translateY(-28px); opacity: 0; }
}

/* ── Shake ──────────────────────────────────────── */
@keyframes shake {
  0%,100% { transform: translateX(0) rotate(0deg); }
  14%      { transform: translateX(-10px) rotate(-4deg); }
  28%      { transform: translateX(10px)  rotate(4deg); }
  42%      { transform: translateX(-7px) rotate(-2deg); }
  57%      { transform: translateX(7px)  rotate(2deg); }
  71%      { transform: translateX(-3px); }
  85%      { transform: translateX(3px); }
}

@keyframes shakeCentered {
  0%,100% { transform: translateX(-50%) rotate(0deg); }
  14%      { transform: translateX(calc(-50% - 10px)) rotate(-4deg); }
  28%      { transform: translateX(calc(-50% + 10px)) rotate(4deg); }
  42%      { transform: translateX(calc(-50% - 7px)) rotate(-2deg); }
  57%      { transform: translateX(calc(-50% + 7px)) rotate(2deg); }
  71%      { transform: translateX(calc(-50% - 3px)); }
  85%      { transform: translateX(calc(-50% + 3px)); }
}

.shake         { animation: shake 0.52s ease !important; }
.shakeCentered { animation: shakeCentered 0.52s ease !important; }

/* ── Splash ─────────────────────────────────────── */
.splash-drop {
  position: absolute;
  border-radius: 50%;
  background: rgba(100, 200, 255, 0.78);
  animation: splashPop 0.8s ease-out forwards;
}

@keyframes splashPop {
  0%   { transform: scale(0);   opacity: 0.9; }
  55%  { opacity: 0.6; }
  100% { transform: scale(3.5); opacity: 0; }
}

/* ── Dog bob ────────────────────────────────────── */
@keyframes dogBob {
  0%,100% { transform: translateX(-50%) translateY(0px); }
  50%     { transform: translateX(-50%) translateY(-10px); }
}

/* ── Gold shine (rotating rays behind gold) ──────── */
#goldShine {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%) scale(0);
  width: clamp(480px, 66vw, 820px);
  height: clamp(480px, 66vw, 820px);
  border-radius: 50%;
  background:
    radial-gradient(circle at 50% 50%, rgba(255,245,150,0.7) 0%, rgba(255,210,0,0.3) 30%, transparent 62%),
    conic-gradient(
      from 0deg,
      transparent 0deg,   rgba(255,225,0,0.6)  10deg,  transparent 20deg,
      transparent 45deg,  rgba(255,205,60,0.5)  55deg,  transparent 65deg,
      transparent 90deg,  rgba(255,225,0,0.6)  100deg, transparent 110deg,
      transparent 135deg, rgba(255,205,60,0.5)  145deg, transparent 155deg,
      transparent 180deg, rgba(255,225,0,0.6)  190deg, transparent 200deg,
      transparent 225deg, rgba(255,205,60,0.5)  235deg, transparent 245deg,
      transparent 270deg, rgba(255,225,0,0.6)  280deg, transparent 290deg,
      transparent 315deg, rgba(255,205,60,0.5)  325deg, transparent 335deg,
      transparent 360deg
    );
  pointer-events: none;
  z-index: 347;
  opacity: 0;
}

/* ── Gold backdrop (dark vignette for contrast) ───── */
#goldBackdrop {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%) scale(0);
  width: clamp(300px, 40vw, 520px);
  height: clamp(300px, 40vw, 520px);
  border-radius: 50%;
  background: radial-gradient(circle at 50% 50%,
    rgba(0,15,40,0.72) 0%,
    rgba(0,10,30,0.45) 50%,
    transparent 78%
  );
  pointer-events: none;
  z-index: 348;
  opacity: 0;
}

#goldBackdrop.active {
  animation: shineIn 0.45s 0.1s ease forwards;
}

#goldShine.active {
  animation:
    shineIn      0.5s ease             forwards,
    shineRotate  6s   0.5s linear      infinite,
    shineGlitter 1.5s 0.4s ease-in-out infinite;
}

@keyframes shineIn {
  0%   { opacity: 0; transform: translate(-50%, -50%) scale(0); }
  100% { opacity: 1; transform: translate(-50%, -50%) scale(1); }
}

@keyframes shineRotate {
  from { transform: translate(-50%, -50%) scale(1) rotate(0deg); }
  to   { transform: translate(-50%, -50%) scale(1) rotate(360deg); }
}

@keyframes shineGlitter {
  0%, 100% { filter: brightness(1)   saturate(1); }
  30%       { filter: brightness(1.6) saturate(1.4); }
  70%       { filter: brightness(1.2) saturate(1.1); }
}

/* ── Gold award ─────────────────────────────────── */
#goldAward {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%) scale(0);
  width: clamp(240px, 32vw, 420px);
  height: clamp(240px, 32vw, 420px);
  object-fit: contain;
  opacity: 0;
  pointer-events: none;
  z-index: 350;
  transition: none;
}

#goldAward.pop {
  animation:
    goldPopBounce 0.47s ease forwards,
    goldGlowPulse 0.65s 0.3s ease-in-out 3 forwards;
}

@keyframes goldPopBounce {
  0%   { opacity: 0; transform: translate(-50%, -50%) scale(0.2) translateY(20px); animation-timing-function: ease-out; }
  53%  { opacity: 1; transform: translate(-50%, -50%) scale(1.1) translateY(-6px);  animation-timing-function: ease-in-out; }
  100% { opacity: 1; transform: translate(-50%, -50%) scale(1.0) translateY(0px); }
}

@keyframes goldGlowPulse {
  0%, 100% { filter: drop-shadow(0 0 12px rgba(255,210,0,0.9)) drop-shadow(0 0 28px rgba(255,140,0,0.7)) drop-shadow(0 6px 24px rgba(0,0,0,0.85)); }
  50%       { filter: drop-shadow(0 0 36px rgba(255,220,0,1))  drop-shadow(0 0 70px rgba(255,160,0,1))   drop-shadow(0 6px 28px rgba(0,0,0,0.95)); }
}

/* ── Gold particles ─────────────────────────────── */
#goldParticles {
  position: absolute;
  top: 50%;
  left: 50%;
  width: 0;
  height: 0;
  pointer-events: none;
  z-index: 351;
}

.gold-sparkle {
  position: absolute;
  clip-path: polygon(50% 0%,61% 35%,98% 35%,68% 57%,79% 91%,50% 70%,21% 91%,32% 57%,2% 35%,39% 35%);
  animation: goldSparkle 0.7s ease-out forwards;
  opacity: 0;
}

@keyframes goldSparkle {
  0%   { opacity: 0; transform: translate(-50%, -50%); }
  20%  { opacity: 1; }
  100% { opacity: 0; transform: translate(calc(-50% + var(--tx)), calc(-50% + var(--ty))); }
}

.gold-coin {
  position: absolute;
  border-radius: 50%;
  background: radial-gradient(circle at 35% 35%, #FFE566, #F7A800);
  border: 1.5px solid rgba(255,180,0,0.7);
  animation: goldCoin 0.8s ease-out forwards;
  opacity: 0;
}

@keyframes goldCoin {
  0%   { opacity: 0; transform: translate(-50%, -50%) scale(0); }
  20%  { opacity: 1; transform: translate(calc(-50% + var(--cx)), calc(-50% - 35px)) scale(1); }
  65%  { opacity: 0.7; }
  100% { opacity: 0; transform: translate(calc(-50% + var(--cx)), calc(-50% + 18px)) scale(0.8); }
}

/* ── End overlay ────────────────────────────────── */
#endOverlay {
  position: absolute;
  inset: 0;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  background: rgba(0, 80, 190, 0.3);
  opacity: 0;
  pointer-events: none;
  transition: opacity 0.9s ease;
  z-index: 300;
}

#endOverlay.visible {
  opacity: 1;
  pointer-events: all;
}

#endOverlay h1 {
  font-size: clamp(28px, 6vw, 58px);
  color: #fff;
  text-shadow: 0 3px 14px rgba(0,0,0,0.5);
  letter-spacing: 4px;
  animation: bounceIn 0.7s cubic-bezier(0.68,-0.55,0.27,1.55) both;
}

#endOverlay .end-sub {
  font-size: clamp(14px, 3vw, 24px);
  color: rgba(255,255,255,0.92);
  margin-top: 12px;
  text-shadow: 0 1px 6px rgba(0,0,0,0.3);
}

#endOverlay .end-reward {
  font-size: clamp(13px, 2.5vw, 20px);
  color: #FFD700;
  margin-top: 10px;
  text-shadow: 0 0 12px rgba(255,180,0,0.8), 0 1px 4px rgba(0,0,0,0.4);
  letter-spacing: 1px;
  font-weight: 700;
  animation: bounceIn 0.7s 0.35s cubic-bezier(0.68,-0.55,0.27,1.55) both;
}

#endOverlay .restart-hint {
  margin-top: 22px;
  font-size: clamp(11px, 1.8vw, 15px);
  color: rgba(255,255,255,0.5);
  letter-spacing: 0.5px;
}

@keyframes bounceIn {
  0%  { transform: scale(0.4); opacity: 0; }
  60% { transform: scale(1.12); }
  100%{ transform: scale(1);    opacity: 1; }
}

/* ── Door scene ─────────────────────────────────── */
#doorScene {
  position: absolute;
  inset: 0;
  background: url('close-door.png') center / cover no-repeat;
  display: flex;
  align-items: flex-end;
  justify-content: flex-end;
  opacity: 1;
  pointer-events: all;
  transition: opacity 0.6s ease;
  z-index: 350;
  cursor: pointer;
}

#doorScene.open {
  cursor: default;
}

/* open-door.png fades in over the closed door */
#doorScene::before {
  content: '';
  position: absolute;
  inset: 0;
  background: url('open-door.png') center / cover no-repeat;
  opacity: 0;
  transition: opacity 0.4s ease;
  pointer-events: none;
}

#doorScene.open::before {
  opacity: 1;
}

#doorScene.hidden {
  opacity: 0;
  pointer-events: none;
}

#doorScene #doorDog {
  position: relative;
  z-index: 1;
  width: clamp(260px, 34vw, 480px);
  height: auto;
  margin-right: clamp(20px, 5vw, 80px);
  margin-bottom: clamp(10px, 3vh, 50px);
  pointer-events: none;
  animation: dogIdle 2.5s ease-in-out infinite;
}

/* Dog becomes draggable once the door is open */
#doorScene.open #doorDog {
  pointer-events: all;
  cursor: grab;
  animation: dogOpenNudge 2.4s ease-in-out infinite;
}

@keyframes dogOpenNudge {
  0%,  38%, 100% { transform: translate(0,     0)    rotate(0deg);  }
  14%             { transform: translate(-22px, -9px) rotate(-7deg); }
  26%             { transform: translate(-6px,  -2px) rotate(-2deg); }
}

#doorScene.open #doorDog:active {
  cursor: grabbing;
}

/* Invisible drop zone covering the door opening area */
#doorDropZone {
  position: absolute;
  left: 20%;
  top: 5%;
  width: 55%;
  height: 88%;
  border-radius: 16px;
  border: 3px dashed transparent;
  transition: border-color 0.2s ease, background 0.2s ease;
  pointer-events: none;
  z-index: 2;
}

#doorDropZone.glow {
  border-color: rgba(255, 255, 255, 0.75);
  background: rgba(255, 255, 255, 0.08);
}


/* ── Door click hint (pulse tap indicator) ────────── */
#doorClickHint {
  position: absolute;
  top: 44%;
  left: 40%;
  transform: translate(-50%, -50%);
  display: flex;
  flex-direction: column;
  align-items: center;
  pointer-events: none;
  z-index: 5;
  animation: hintAppear 0.6s 1.2s both;
}

/* hide once door is open */
#doorScene.open #doorClickHint {
  display: none;
}

/* central tap dot */
#doorClickHint .tap-dot {
  position: relative;
  width: 16px;
  height: 16px;
}

#doorClickHint .tap-dot::after {
  content: '';
  position: absolute;
  inset: 0;
  background: rgba(255, 255, 255, 0.95);
  border-radius: 50%;
  box-shadow: 0 0 8px rgba(255,255,255,0.8);
}

/* two expanding rings staggered */
#doorClickHint .ring {
  position: absolute;
  top: 50%;
  left: 50%;
  width: 16px;
  height: 16px;
  border: 2.5px solid rgba(255, 255, 255, 0.85);
  border-radius: 50%;
  transform: translate(-50%, -50%);
  animation: tapRipple 1.8s ease-out infinite;
}

#doorClickHint .ring.r2 { animation-delay: 0.7s; }
#doorClickHint .ring.r3 { animation-delay: 1.4s; }

@keyframes tapRipple {
  0%   { width: 16px;  height: 16px;  opacity: 0.85; }
  100% { width: 100px; height: 100px; opacity: 0;    }
}

@keyframes hintAppear {
  from { opacity: 0; transform: translate(-50%, -50%) scale(0.7); }
  to   { opacity: 1; transform: translate(-50%, -50%) scale(1);   }
}

@keyframes dogIdle {
  0%, 100% { transform: translateY(0px); }
  50%       { transform: translateY(-8px); }
}

/* ── Start overlay ──────────────────────────────── */
#startOverlay {
  position: absolute;
  inset: 0;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  background: rgba(0, 60, 160, 0.45);
  opacity: 1;
  pointer-events: all;
  transition: opacity 0.75s ease;
  z-index: 400;
}

#startOverlay.hidden {
  opacity: 0;
  pointer-events: none;
}

#startOverlay h1 {
  font-size: clamp(26px, 5.5vw, 54px);
  color: #fff;
  text-shadow: 0 3px 14px rgba(0,0,0,0.5);
  letter-spacing: 4px;
  text-align: center;
  animation: bounceIn 0.7s cubic-bezier(0.68,-0.55,0.27,1.55) both;
}

#startBtn {
  margin-top: 32px;
  padding: 14px 44px;
  font-size: clamp(13px, 2.2vw, 19px);
  font-family: inherit;
  font-weight: 700;
  letter-spacing: 2px;
  text-transform: uppercase;
  color: #fff;
  background: linear-gradient(135deg, #f7c948, #f0923c);
  border: none;
  border-radius: 50px;
  cursor: pointer;
  box-shadow: 0 4px 18px rgba(0,0,0,0.3);
  transition: transform 0.15s ease, box-shadow 0.15s ease;
  animation: bounceIn 0.7s 0.22s cubic-bezier(0.68,-0.55,0.27,1.55) both;
}

#startBtn:hover {
  transform: scale(1.07);
  box-shadow: 0 6px 26px rgba(0,0,0,0.4);
}

#startBtn:active {
  transform: scale(0.96);
}
</style>
</head>
<body>
<div id="stage">

  <!-- HUD -->
  <div id="hud">
    <div id="progressText">PREP: 0 / 3</div>
    <div id="progressBar"><div id="progressFill"></div></div>
  </div>

  <!-- ── Sand items ── -->
  <div id="itemJuice" class="sand-item">
    <img src="juice.png" alt="Juice">
    <div class="checkmark">&#10003;</div>
  </div>

  <div id="itemSunCream" class="sand-item">
    <img src="sun-cream.png" alt="Sun Cream">
    <div class="checkmark">&#10003;</div>
  </div>

  <div id="itemSwimRing" class="sand-item">
    <img src="swim-ring.png" alt="Swim Ring">
    <div class="checkmark">&#10003;</div>
  </div>

  <!-- ── Dog container ── -->
  <div id="dogContainer">

    <img id="dogSad"        src="sad-dog.png"              alt="Sad Dog">
    <img id="dogJuice"      src="dog-juice.png"            alt="Dog with Juice">
    <img id="dogJuiceCream" src="dog-juice-sun cream.png"  alt="Dog with Juice and Sun Cream">
    <img id="dogHappy"      src="happy-dog.png"            alt="Happy Dog">

    <!-- Equipped overlays -->
    <img id="equipJuice"    src="juice.png"     alt="">
    <img id="equipSunCream" src="sun-cream.png" alt="">

    <!-- Sad cloud SVG -->
    <div id="sadCloud">
      <svg width="80" height="48" viewBox="0 0 80 48" fill="none" xmlns="http://www.w3.org/2000/svg">
        <ellipse cx="40" cy="36" rx="32" ry="14" fill="#aaa" opacity="0.65"/>
        <ellipse cx="24" cy="29" rx="16" ry="11" fill="#bbb" opacity="0.7"/>
        <ellipse cx="54" cy="28" rx="14" ry="10" fill="#bbb" opacity="0.7"/>
        <ellipse cx="40" cy="22" rx="18" ry="13" fill="#ccc" opacity="0.78"/>
      </svg>
    </div>

    <!-- Star burst -->
    <div id="starBurst"></div>

    <!-- Speech bubble -->
    <div id="dogBubble">I'm thirsty</div>

  </div><!-- /dogContainer -->

  <!-- Swim ring floating on sea (shown after dog reaches ocean) -->
  <img id="equipSwimRing" src="swim-ring.png" alt="">

  <!-- Splash anchor (positioned by JS) -->
  <div id="splash" style="position:fixed;pointer-events:none;z-index:160;"></div>

  <!-- Gold shine + award + particle container -->
  <div id="goldShine"></div>
  <div id="goldBackdrop"></div>
  <img id="goldAward" src="gold.png" alt="Gold Award">
  <div id="goldParticles"></div>

  <!-- Hint text -->
  <div id="hintText">Not yet!</div>

  <!-- End overlay -->
  <div id="endOverlay">
    <h1>READY TO SWIM!</h1>
    <p class="end-sub">dog: happy</p>
    <p class="end-reward">Treasure unlocked!</p>
    <p class="restart-hint">click anywhere to restart</p>
  </div>

  <!-- Door scene (shown after clicking start, before beach game) -->
  <div id="doorScene" class="hidden">
    <div id="doorDropZone"></div>
    <!-- Click hint: pulsing tap indicator on the closed door -->
    <div id="doorClickHint">
      <div class="tap-dot">
        <div class="ring r1"></div>
        <div class="ring r2"></div>
        <div class="ring r3"></div>
      </div>
    </div>
    <img id="doorDog" src="dog.png" alt="Dog">
  </div>

  <!-- Start overlay -->
  <div id="startOverlay">
    <h1>Help the puppy to swim!</h1>
    <button id="startBtn">click to start</button>
  </div>

</div><!-- #stage -->

<script>
(function () {
  'use strict';

  // ── State ─────────────────────────────────────────────────────────
  let step      = 0;
  let busy      = true;   // blocked until start screen is dismissed
  let endShown  = false;
  let hintTimer = null;


  // ── Elements ──────────────────────────────────────────────────────
  const dogContainer  = document.getElementById('dogContainer');
  const dogSad        = document.getElementById('dogSad');
  const dogJuice      = document.getElementById('dogJuice');
  const dogJuiceCream = document.getElementById('dogJuiceCream');
  const dogHappy      = document.getElementById('dogHappy');
  const sadCloud      = document.getElementById('sadCloud');

  // Dog states indexed by step: 0=sad, 1=juice, 2=juice+cream, 3=happy
  const DOG_STATES = [dogSad, dogJuice, dogJuiceCream, dogHappy];
  let activeDog = dogSad;
  const starBurst    = document.getElementById('starBurst');
  const dogBubble    = document.getElementById('dogBubble');
  const hintText     = document.getElementById('hintText');
  const endOverlay   = document.getElementById('endOverlay');
  const splash       = document.getElementById('splash');
  const progressText = document.getElementById('progressText');
  const progressFill = document.getElementById('progressFill');

  const itemJuice    = document.getElementById('itemJuice');
  const itemSunCream = document.getElementById('itemSunCream');
  const itemSwimRing = document.getElementById('itemSwimRing');
  const equipJuice   = document.getElementById('equipJuice');
  const equipSunCream= document.getElementById('equipSunCream');
  const equipSwimRing= document.getElementById('equipSwimRing');
  const goldShine    = document.getElementById('goldShine');
  const goldBackdrop = document.getElementById('goldBackdrop');
  const goldAward    = document.getElementById('goldAward');
  const goldParticles= document.getElementById('goldParticles');
  const startOverlay  = document.getElementById('startOverlay');
  const startBtn      = document.getElementById('startBtn');
  const doorScene     = document.getElementById('doorScene');
  const doorDog       = document.getElementById('doorDog');
  const doorDropZone  = document.getElementById('doorDropZone');

  // ── Dog-drag state (door scene) ───────────────────────────────────
  let dogDragActive   = false;
  let dogDragClone    = null;
  let dogDragOX       = 0;
  let dogDragOY       = 0;
  let dogJustDragged  = false;

  const ITEMS = [
    { el: itemJuice,    equip: equipJuice,    stepIdx: 0, centered: false },
    { el: itemSunCream, equip: equipSunCream,  stepIdx: 1, centered: true  },
    { el: itemSwimRing, equip: equipSwimRing,  stepIdx: 2, centered: false },
  ];

  // ── Init ──────────────────────────────────────────────────────────
  function init() {
    // All three items: click interaction
    ITEMS.forEach(item =>
      item.el.addEventListener('click', () => onItemClick(item))
    );
    // Dog drag (door scene)
    initDoorDogDrag();
    endOverlay.addEventListener('click', restart);
    startBtn.addEventListener('click', startGame);
    doorScene.addEventListener('click', onDoorClick);
  }

  // ── Start game ────────────────────────────────────────────────────
  function startGame() {
    startOverlay.classList.add('hidden');
    // Show door scene; beach game starts when user clicks it
    doorScene.classList.remove('hidden');
  }

  function onDoorClick() {
    if (dogJustDragged) { dogJustDragged = false; return; }
    if (!doorScene.classList.contains('open')) {
      doorScene.classList.add('open');
    }
    // Door is open: user must drag the dog — plain clicks do nothing
  }

  // ── Dog drag (door scene) ─────────────────────────────────────────
  function initDoorDogDrag() {
    doorDog.addEventListener('mousedown',  onDogDragDown);
    doorDog.addEventListener('touchstart', onDogDragTouchStart, { passive: false });
  }

  function onDogDragDown(e) {
    if (!doorScene.classList.contains('open')) return;
    e.preventDefault();
    beginDogDrag(e.clientX, e.clientY);
    document.addEventListener('mousemove', onDogDragMove);
    document.addEventListener('mouseup',   onDogDragUp);
  }

  function onDogDragTouchStart(e) {
    if (!doorScene.classList.contains('open')) return;
    e.preventDefault();
    const t = e.touches[0];
    beginDogDrag(t.clientX, t.clientY);
    document.addEventListener('touchmove', onDogDragTouchMove, { passive: false });
    document.addEventListener('touchend',  onDogDragTouchEnd);
  }

  function beginDogDrag(cx, cy) {
    const rect = doorDog.getBoundingClientRect();
    dogDragOX = cx - rect.left;
    dogDragOY = cy - rect.top;
    dogDragActive = true;

    dogDragClone = document.createElement('img');
    dogDragClone.src = doorDog.src;
    dogDragClone.style.cssText =
      'position:fixed;pointer-events:none;z-index:500;opacity:0.92;'
      + 'width:' + rect.width  + 'px;'
      + 'height:' + rect.height + 'px;'
      + 'left:'  + rect.left   + 'px;'
      + 'top:'   + rect.top    + 'px;';
    document.body.appendChild(dogDragClone);
    doorDog.style.animation = 'none'; // stop nudge hint while dragging
    doorDog.style.opacity   = '0.3';
  }

  function onDogDragMove(e)      { moveDogDrag(e.clientX, e.clientY); }
  function onDogDragUp(e)        { endDogDrag(e.clientX, e.clientY); }
  function onDogDragTouchMove(e) { e.preventDefault(); const t = e.touches[0]; moveDogDrag(t.clientX, t.clientY); }
  function onDogDragTouchEnd(e)  { const t = e.changedTouches[0]; endDogDrag(t.clientX, t.clientY); }

  function moveDogDrag(cx, cy) {
    if (!dogDragActive || !dogDragClone) return;
    dogDragClone.style.left = (cx - dogDragOX) + 'px';
    dogDragClone.style.top  = (cy - dogDragOY) + 'px';

    const dz   = doorDropZone.getBoundingClientRect();
    const over = cx >= dz.left && cx <= dz.right && cy >= dz.top && cy <= dz.bottom;
    doorDropZone.classList.toggle('glow', over);
  }

  function endDogDrag(cx, cy) {
    if (!dogDragActive) return;
    dogDragActive  = false;
    dogJustDragged = true;

    document.removeEventListener('mousemove', onDogDragMove);
    document.removeEventListener('mouseup',   onDogDragUp);
    document.removeEventListener('touchmove', onDogDragTouchMove);
    document.removeEventListener('touchend',  onDogDragTouchEnd);
    doorDropZone.classList.remove('glow');

    const dz     = doorDropZone.getBoundingClientRect();
    const onZone = cx >= dz.left && cx <= dz.right && cy >= dz.top && cy <= dz.bottom;

    if (onZone) {
      removeDogDragClone();
      doorDog.style.opacity = '1';
      doorScene.classList.add('hidden');
      busy = false;
      dogBubble.classList.add('visible');
    } else {
      // Snap clone back to original dog position then restore
      const orig = doorDog.getBoundingClientRect();
      dogDragClone.style.transition = 'left .3s ease, top .3s ease, opacity .3s ease';
      dogDragClone.style.left    = orig.left + 'px';
      dogDragClone.style.top     = orig.top  + 'px';
      dogDragClone.style.opacity = '0';
      setTimeout(() => {
        removeDogDragClone();
        doorDog.style.opacity   = '1';
        doorDog.style.animation = ''; // re-enable nudge hint (CSS rule takes over)
      }, 320);
    }
  }

  function removeDogDragClone() {
    if (dogDragClone && dogDragClone.parentNode) dogDragClone.parentNode.removeChild(dogDragClone);
    dogDragClone = null;
  }

  // ── Click (juice & sun-cream) ─────────────────────────────────────
  function onItemClick(item) {
    if (busy || endShown) return;
    if (item.el.classList.contains('used')) return;
    if (item.stepIdx === step) applyItem(item);
    else                       wrongItem(item);
  }

  // ── Wrong order feedback ──────────────────────────────────────────
  function wrongItem(item) {
    item.el.classList.remove('shake', 'shakeCentered');
    void item.el.offsetWidth;
    item.el.classList.add(item.centered ? 'shakeCentered' : 'shake');
    setTimeout(() => item.el.classList.remove('shake', 'shakeCentered'), 560);

    if (hintTimer) clearTimeout(hintTimer);
    hintText.style.opacity = '1';
    hintTimer = setTimeout(() => { hintText.style.opacity = '0'; }, 1500);
  }

  // ── Apply correct item ────────────────────────────────────────────
  function applyItem(item) {
    busy = true;
    dogBubble.classList.remove('visible');

    // ── Swim ring: click — immediate swap, no fly animation ──────────
    if (item.stepIdx === 2) {
      item.el.classList.add('used');
      item.el.querySelector('.checkmark').classList.add('shown');
      step++;
      updateHUD();

      // Hard instant swap: dog-juice-sun cream → happy-dog (Rule 4)
      dogJuiceCream.style.transition = 'none';
      dogHappy.style.transition      = 'none';
      dogJuiceCream.style.opacity    = '0';
      dogHappy.style.opacity         = '1';
      activeDog = dogHappy;
      // Re-arm CSS transitions for any later crossfades
      requestAnimationFrame(() => requestAnimationFrame(() => {
        dogJuiceCream.style.transition = '';
        dogHappy.style.transition      = '';
      }));

      busy = false;
      setTimeout(completeAll, 420);
      return;
    }

    // ── Juice / sun-cream: click items — fly animation then state change ─
    flyToDog(item, () => {
      item.equip.style.opacity = '1';
      item.el.classList.add('used');
      item.el.querySelector('.checkmark').classList.add('shown');
      step++;
      updateHUD();
      crossfadeDog(DOG_STATES[step]);        // step 1→dogJuice, step 2→dogJuiceCream
      if (step === 1) {
        dogBubble.textContent = 'The sun is very hot today.';
        void dogBubble.offsetWidth;
        dogBubble.classList.add('visible');
      } else if (step === 2) {
        dogBubble.textContent = 'That swim ring looks pretty!';
        void dogBubble.offsetWidth;
        dogBubble.classList.add('visible');
      }
      busy = false;
    });
  }

  // ── Fly animation ─────────────────────────────────────────────────
  function flyToDog(item, cb) {
    const fromRect = item.el.getBoundingClientRect();
    const dogRect  = dogContainer.getBoundingClientRect();

    const imgEl = item.el.querySelector('img');
    const clone = document.createElement('img');
    clone.src   = imgEl.currentSrc || imgEl.src;

    const startX = fromRect.left + fromRect.width  / 2 - 38;
    const startY = fromRect.top  + fromRect.height / 2 - 38;

    clone.style.cssText = [
      'position:fixed',
      'width:76px', 'height:76px',
      'object-fit:contain',
      'pointer-events:none',
      'z-index:500',
      'left:' + startX + 'px',
      'top:'  + startY + 'px',
      'transition:left .65s cubic-bezier(.25,.46,.45,.94),'
                + 'top .65s cubic-bezier(.25,.46,.45,.94),'
                + 'transform .65s ease,'
                + 'opacity .18s ease .54s',
    ].join(';');
    document.body.appendChild(clone);

    const tx = dogRect.left + dogRect.width  / 2 - 38;
    const ty = dogRect.top  + dogRect.height / 2 - 38;

    requestAnimationFrame(() => requestAnimationFrame(() => {
      clone.style.left      = tx + 'px';
      clone.style.top       = ty + 'px';
      clone.style.transform = 'scale(0.5)';
      clone.style.opacity   = '0';
    }));

    setTimeout(() => { document.body.removeChild(clone); cb(); }, 800);
  }

  // ── HUD ───────────────────────────────────────────────────────────
  function updateHUD() {
    progressText.textContent = 'PREP: ' + step + ' / 3';
    progressFill.style.width = (step / 3 * 100) + '%';
  }

  // ── Dog crossfade ─────────────────────────────────────────────────
  function crossfadeDog(toEl) {
    if (activeDog === toEl) return;
    activeDog.style.opacity = '0';
    toEl.style.opacity      = '1';
    activeDog = toEl;
  }

  // ══════════════════════════════════════════════════════════════════

  // ── All 3 applied ─────────────────────────────────────────────────
  function completeAll() {
    busy = true;
    sadCloud.style.opacity = '0';
    fireStars();
    setTimeout(() => {
      crossfadeDog(dogHappy);
      setTimeout(() => {
        showGoldReward();
        setTimeout(moveDogToOcean, 650);
      }, 900);
    }, 1100);
  }

  // ── Gold reward ───────────────────────────────────────
  function showGoldReward() {
    goldShine.classList.add('active');
    goldBackdrop.classList.add('active');
    goldAward.classList.add('pop');
    emitGoldParticles();
  }

  function emitGoldParticles() {
    goldParticles.innerHTML = '';
    const colors = ['#FFD700','#FFA500','#FFE066','#FF6B6B','#7ECEF6','#98FB98'];
    const count  = 10;

    // Sparkles — fly outward in all directions
    for (let i = 0; i < count; i++) {
      const angle = (i / count) * 360 + (Math.random() * 28 - 14);
      const dist  = 55 + Math.random() * 65;
      const size  = 7 + Math.random() * 9;
      const delay = Math.random() * 120;
      const tx    = Math.cos(angle * Math.PI / 180) * dist;
      const ty    = Math.sin(angle * Math.PI / 180) * dist;
      const s     = document.createElement('div');
      s.className = 'gold-sparkle';
      s.style.cssText = '--tx:' + tx + 'px;--ty:' + ty + 'px;'
        + 'width:' + size + 'px;height:' + size + 'px;'
        + 'background:' + colors[i % colors.length] + ';'
        + 'animation-delay:' + delay + 'ms;';
      goldParticles.appendChild(s);
    }

    // Coins — pop upward, arc left/right, fall with gravity
    for (let i = 0; i < 4; i++) {
      const size  = 10 + Math.random() * 8;
      const cx    = (i - 1.5) * 30 + (Math.random() * 12 - 6);
      const delay = i * 60 + Math.random() * 40;
      const c     = document.createElement('div');
      c.className = 'gold-coin';
      c.style.cssText = '--cx:' + cx + 'px;'
        + 'width:' + size + 'px;height:' + size + 'px;'
        + 'animation-delay:' + delay + 'ms;';
      goldParticles.appendChild(c);
    }

    setTimeout(() => { goldParticles.innerHTML = ''; }, 1000);
  }

  // ── Stars ─────────────────────────────────────────────────────────
  function fireStars() {
    starBurst.innerHTML = '';
    const pal   = ['#FFD700','#FF6B6B','#7ECEF6','#98FB98','#FF69B4','#FFA500'];
    const spots = ['8% 50%','25% 12%','50% 55%','74% 10%','92% 48%','18% 82%','50% 0%','82% 80%'];
    spots.forEach((pos, i) => {
      const [l, t] = pos.split(' ');
      const s = document.createElement('div');
      s.className = 'star';
      s.style.cssText = 'left:' + l + ';top:' + t
        + ';width:'  + (9 + (i % 4) * 3) + 'px'
        + ';height:' + (9 + (i % 4) * 3) + 'px'
        + ';background:' + pal[i % pal.length]
        + ';animation-delay:' + (i * 0.09) + 's';
      starBurst.appendChild(s);
    });
    setTimeout(() => { starBurst.innerHTML = ''; }, 2400);
  }

  // ── Move dog to ocean ─────────────────────────────────────────────
  function moveDogToOcean() {
    dogContainer.style.transition = 'bottom 1.6s cubic-bezier(.4,0,.2,1)';
    dogContainer.style.bottom = '58%';
    setTimeout(() => {
      showSplash();
      equipSwimRing.style.opacity = '1';
      equipSwimRing.classList.add('floating');
      setTimeout(() => {
        dogContainer.style.transition = 'none';
        dogContainer.style.animation  = 'dogBob 1.6s ease-in-out infinite';
        setTimeout(showEndScreen, 800);
      }, 900);
    }, 1650);
  }

  // ── Splash ────────────────────────────────────────────────────────
  function showSplash() {
    const r  = dogContainer.getBoundingClientRect();
    const cx = r.left + r.width / 2;
    const cy = r.bottom - r.height * 0.22;

    Object.assign(splash.style, {
      left: (cx - 65) + 'px', top: (cy - 32) + 'px',
      width: '130px', height: '65px', opacity: '1',
    });
    splash.innerHTML = '';

    [[10,42,19,0],[30,0,26,0.07],[50,52,21,0.04],[65,5,32,0.1],[82,38,17,0.03],[44,-22,23,0.06]]
      .forEach(([l, t, sz, d]) => {
        const dr = document.createElement('div');
        dr.className = 'splash-drop';
        dr.style.cssText = 'left:' + l + '%;top:' + t + '%;width:' + sz + 'px;height:' + sz + 'px;animation-delay:' + d + 's';
        splash.appendChild(dr);
      });

    setTimeout(() => { splash.innerHTML = ''; }, 1400);
  }

  // ── End screen ────────────────────────────────────────────────────
  function showEndScreen() {
    endShown = true;
    busy     = false;
    endOverlay.classList.add('visible');
  }

  // ── Restart ───────────────────────────────────────────────────────
  function restart() {
    step     = 0;
    busy     = false;
    endShown = false;

    updateHUD();
    endOverlay.classList.remove('visible');

    dogContainer.style.transition = 'none';
    dogContainer.style.animation  = 'none';
    dogContainer.style.bottom     = '18%';
    dogContainer.style.left       = '50%';
    DOG_STATES.forEach(d => { d.style.opacity = '0'; });
    dogSad.style.opacity = '1';
    activeDog = dogSad;

    sadCloud.style.opacity = '1';
    starBurst.innerHTML    = '';

    if (hintTimer) clearTimeout(hintTimer);
    hintText.style.opacity = '0';
    splash.innerHTML       = '';

    ITEMS.forEach(item => {
      item.el.classList.remove('used', 'shake', 'shakeCentered');
      item.el.querySelector('.checkmark').classList.remove('shown');
      item.equip.style.opacity = '0';
    });
    equipSwimRing.classList.remove('floating');
    goldShine.classList.remove('active');
    goldBackdrop.classList.remove('active');
    goldAward.classList.remove('pop');
    goldParticles.innerHTML = '';
    dogBubble.textContent = "I'm thirsty";
    dogBubble.classList.add('visible');
    doorScene.classList.remove('open');
  }

  init();
}());
</script>
</body>
</html>
