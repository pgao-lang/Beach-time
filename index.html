<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Beach Day!</title>
<style>
* { margin: 0; padding: 0; box-sizing: border-box; }

body {
  overflow: hidden;
  width: 100vw;
  height: 100vh;
  font-family: 'Segoe UI', Tahoma, sans-serif;
}

#stage {
  position: relative;
  width: 100vw;
  height: 100vh;
  background: url('beach.png') center / cover no-repeat;
  overflow: hidden;
}

/* ── HUD ── */
#hud {
  position: absolute;
  top: 16px;
  left: 50%;
  transform: translateX(-50%);
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 6px;
  z-index: 100;
  background: rgba(255, 255, 255, 0.78);
  border-radius: 22px;
  padding: 8px 22px 10px;
  box-shadow: 0 2px 14px rgba(0,0,0,0.18);
  white-space: nowrap;
}

#progressText {
  font-size: 13px;
  font-weight: 700;
  color: #444;
  letter-spacing: 1.5px;
  text-transform: uppercase;
}

#progressBar {
  width: 160px;
  height: 10px;
  background: #ddd;
  border-radius: 6px;
  overflow: hidden;
}

#progressFill {
  height: 100%;
  width: 0%;
  background: linear-gradient(90deg, #f7c948, #f0923c);
  border-radius: 6px;
  transition: width 0.45s cubic-bezier(0.4, 0, 0.2, 1);
}

/* ── Dog container ── */
#dogContainer {
  position: absolute;
  bottom: 22%;
  left: 50%;
  transform: translateX(-50%);
  width: 160px;
  height: 160px;
}

#dogSad, #dogHappy {
  position: absolute;
  top: 0; left: 0;
  width: 100%; height: 100%;
  object-fit: contain;
  transition: opacity 0.65s ease;
}

#dogHappy { opacity: 0; }

/* ── Equipped items ── */
#equipJuice {
  position: absolute;
  width: 52px;
  left: -28px;
  bottom: 24px;
  opacity: 0;
  object-fit: contain;
  transition: opacity 0.35s ease;
  pointer-events: none;
}

#equipSunCream {
  position: absolute;
  width: 44px;
  right: -22px;
  top: 28px;
  opacity: 0;
  object-fit: contain;
  transition: opacity 0.35s ease;
  pointer-events: none;
}

#equipSwimRing {
  position: absolute;
  width: 132px;
  left: 50%;
  transform: translateX(-50%);
  bottom: -22px;
  opacity: 0;
  object-fit: contain;
  transition: opacity 0.35s ease;
  pointer-events: none;
}

/* ── Sad cloud ── */
#sadCloud {
  position: absolute;
  top: -54px;
  left: 50%;
  transform: translateX(-50%);
  transition: opacity 0.55s ease;
  animation: cloudFloat 2.2s ease-in-out infinite;
  pointer-events: none;
}

@keyframes cloudFloat {
  0%, 100% { transform: translateX(-50%) translateY(0px); }
  50%       { transform: translateX(-50%) translateY(-7px); }
}

/* ── Sand items ── */
.sand-item {
  position: absolute;
  width: 80px;
  height: 80px;
  cursor: pointer;
  user-select: none;
  transition: opacity 0.3s ease, filter 0.2s ease;
}

.sand-item img {
  width: 100%;
  height: 100%;
  object-fit: contain;
  pointer-events: none;
  transition: transform 0.18s ease;
}

.sand-item:hover:not(.used) img {
  filter: drop-shadow(0 0 10px rgba(255, 220, 0, 0.95)) drop-shadow(0 0 4px rgba(255,180,0,0.7));
  transform: scale(1.1);
  cursor: pointer;
}

.sand-item.used {
  opacity: 0.38;
  pointer-events: none;
}

/* Checkmark badge */
.checkmark {
  position: absolute;
  top: -9px;
  right: -9px;
  width: 25px;
  height: 25px;
  background: #27ae60;
  border: 2px solid #fff;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 13px;
  color: white;
  line-height: 1;
  opacity: 0;
  transform: scale(0);
  transition: opacity 0.2s ease, transform 0.35s cubic-bezier(0.68, -0.55, 0.27, 1.55);
  z-index: 10;
}

.checkmark.shown {
  opacity: 1;
  transform: scale(1);
}

/* Item positions */
#itemJuice    { bottom: 23%; left: 18%; }
#itemSunCream { bottom: 21%; left: 50%; transform: translateX(-50%); }
#itemSwimRing { bottom: 23%; right: 18%; }

/* ── Hint text ── */
#hintText {
  position: absolute;
  bottom: 17%;
  left: 50%;
  transform: translateX(-50%);
  background: rgba(220, 60, 60, 0.88);
  color: #fff;
  padding: 6px 18px;
  border-radius: 20px;
  font-size: 14px;
  font-weight: 700;
  letter-spacing: 0.5px;
  opacity: 0;
  pointer-events: none;
  z-index: 50;
  white-space: nowrap;
  transition: opacity 0.3s ease;
}

/* ── Star burst ── */
#starBurst {
  position: absolute;
  top: -90px;
  left: 50%;
  transform: translateX(-50%);
  width: 130px;
  height: 90px;
  pointer-events: none;
  opacity: 1;
}

.star {
  position: absolute;
  clip-path: polygon(50% 0%,61% 35%,98% 35%,68% 57%,79% 91%,50% 70%,21% 91%,32% 57%,2% 35%,39% 35%);
  animation: starPop 0.9s ease-out forwards;
  opacity: 0;
}

@keyframes starPop {
  0%   { transform: scale(0) rotate(0deg);   opacity: 0; }
  35%  { opacity: 1; transform: scale(1.5) rotate(160deg); }
  100% { transform: scale(0.4) rotate(340deg) translateY(-24px); opacity: 0; }
}

/* ── Shake ── */
@keyframes shake {
  0%,100% { transform: translateX(0) rotate(0deg); }
  14%      { transform: translateX(-9px) rotate(-4deg); }
  28%      { transform: translateX(9px)  rotate(4deg); }
  42%      { transform: translateX(-6px) rotate(-2deg); }
  57%      { transform: translateX(6px)  rotate(2deg); }
  71%      { transform: translateX(-3px); }
  85%      { transform: translateX(3px); }
}

/* Shake variant for centered item */
@keyframes shakeCentered {
  0%,100% { transform: translateX(-50%) rotate(0deg); }
  14%      { transform: translateX(calc(-50% - 9px)) rotate(-4deg); }
  28%      { transform: translateX(calc(-50% + 9px)) rotate(4deg); }
  42%      { transform: translateX(calc(-50% - 6px)) rotate(-2deg); }
  57%      { transform: translateX(calc(-50% + 6px)) rotate(2deg); }
  71%      { transform: translateX(calc(-50% - 3px)); }
  85%      { transform: translateX(calc(-50% + 3px)); }
}

.shake         { animation: shake 0.52s ease !important; }
.shakeCentered { animation: shakeCentered 0.52s ease !important; }

/* ── Splash ── */
#splash {
  position: fixed;
  pointer-events: none;
  z-index: 150;
  opacity: 1;
}

.splash-drop {
  position: absolute;
  border-radius: 50%;
  background: rgba(120, 210, 255, 0.75);
  animation: splashPop 0.75s ease-out forwards;
}

@keyframes splashPop {
  0%   { transform: scale(0);   opacity: 0.85; }
  55%  { opacity: 0.6; }
  100% { transform: scale(3.2); opacity: 0; }
}

/* ── Dog bob ── */
@keyframes dogBob {
  0%,100% { transform: translateX(-50%) translateY(0px); }
  50%     { transform: translateX(-50%) translateY(-9px); }
}

/* ── End overlay ── */
#endOverlay {
  position: absolute;
  inset: 0;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  background: rgba(0, 90, 200, 0.32);
  opacity: 0;
  pointer-events: none;
  transition: opacity 0.85s ease;
  z-index: 300;
}

#endOverlay.visible {
  opacity: 1;
  pointer-events: all;
}

#endOverlay h1 {
  font-size: clamp(26px, 6vw, 54px);
  color: #fff;
  text-shadow: 0 3px 12px rgba(0,0,0,0.45);
  letter-spacing: 4px;
  animation: bounceIn 0.65s cubic-bezier(0.68,-0.55,0.27,1.55) both;
}

#endOverlay .end-sub {
  font-size: clamp(13px, 2.8vw, 22px);
  color: rgba(255,255,255,0.92);
  margin-top: 12px;
  text-shadow: 0 1px 6px rgba(0,0,0,0.3);
}

#endOverlay .restart-hint {
  margin-top: 22px;
  font-size: clamp(10px, 1.8vw, 14px);
  color: rgba(255,255,255,0.5);
  letter-spacing: 0.5px;
}

@keyframes bounceIn {
  0%  { transform: scale(0.4); opacity: 0; }
  60% { transform: scale(1.12); }
  100%{ transform: scale(1);    opacity: 1; }
}
</style>
</head>
<body>
<div id="stage">

  <!-- HUD -->
  <div id="hud">
    <div id="progressText">PREP: 0 / 3</div>
    <div id="progressBar"><div id="progressFill"></div></div>
  </div>

  <!-- Sand items -->
  <div id="itemJuice" class="sand-item">
    <img src="juice.png" alt="Juice">
    <div class="checkmark">&#10003;</div>
  </div>
  <div id="itemSunCream" class="sand-item">
    <img src="sun-cream.png" alt="Sun Cream">
    <div class="checkmark">&#10003;</div>
  </div>
  <div id="itemSwimRing" class="sand-item">
    <img src="swim-ring.png" alt="Swim Ring">
    <div class="checkmark">&#10003;</div>
  </div>

  <!-- Dog container -->
  <div id="dogContainer">
    <img id="dogSad"   src="sad-dog.png"   alt="Sad Dog">
    <img id="dogHappy" src="happy-dog.png" alt="Happy Dog">

    <!-- Equipped overlays -->
    <img id="equipJuice"    src="juice.png"     alt="">
    <img id="equipSunCream" src="sun-cream.png" alt="">
    <img id="equipSwimRing" src="swim-ring.png" alt="">

    <!-- Sad cloud (SVG) -->
    <div id="sadCloud">
      <svg width="74" height="44" viewBox="0 0 74 44" fill="none" xmlns="http://www.w3.org/2000/svg">
        <ellipse cx="37" cy="32" rx="29" ry="13" fill="#aaa" opacity="0.68"/>
        <ellipse cx="23" cy="26" rx="14" ry="10" fill="#b8b8b8" opacity="0.72"/>
        <ellipse cx="50" cy="25" rx="12" ry="9"  fill="#b8b8b8" opacity="0.72"/>
        <ellipse cx="37" cy="20" rx="17" ry="12" fill="#cccccc" opacity="0.78"/>
      </svg>
    </div>

    <!-- Star burst -->
    <div id="starBurst"></div>
  </div>

  <!-- Splash -->
  <div id="splash"></div>

  <!-- Hint text -->
  <div id="hintText">Not yet!</div>

  <!-- End overlay -->
  <div id="endOverlay">
    <h1>READY TO SWIM!</h1>
    <p class="end-sub">dog: happy</p>
    <p class="restart-hint">click anywhere to restart</p>
  </div>

</div><!-- #stage -->

<script>
(function () {
  'use strict';

  // ── State ────────────────────────────────────────────
  let step = 0;          // 0=need juice, 1=suncream, 2=ring, 3=done
  let busy = false;      // prevent overlapping actions
  let endShown = false;  // final sequence ran
  let hintTimer = null;

  // ── Elements ─────────────────────────────────────────
  const stage        = document.getElementById('stage');
  const dogContainer = document.getElementById('dogContainer');
  const dogSad       = document.getElementById('dogSad');
  const dogHappy     = document.getElementById('dogHappy');
  const sadCloud     = document.getElementById('sadCloud');
  const starBurst    = document.getElementById('starBurst');
  const hintText     = document.getElementById('hintText');
  const endOverlay   = document.getElementById('endOverlay');
  const splash       = document.getElementById('splash');
  const progressText = document.getElementById('progressText');
  const progressFill = document.getElementById('progressFill');

  const itemJuice    = document.getElementById('itemJuice');
  const itemSunCream = document.getElementById('itemSunCream');
  const itemSwimRing = document.getElementById('itemSwimRing');
  const equipJuice   = document.getElementById('equipJuice');
  const equipSunCream= document.getElementById('equipSunCream');
  const equipSwimRing= document.getElementById('equipSwimRing');

  // Item descriptor order matches required step order
  const ITEMS = [
    { el: itemJuice,    equip: equipJuice,    stepIdx: 0, centered: false },
    { el: itemSunCream, equip: equipSunCream,  stepIdx: 1, centered: true  },
    { el: itemSwimRing, equip: equipSwimRing,  stepIdx: 2, centered: false },
  ];

  // ── Setup ─────────────────────────────────────────────
  function init() {
    ITEMS.forEach(item => {
      item.el.addEventListener('click', () => onItemClick(item));
    });
    endOverlay.addEventListener('click', restart);
  }

  // ── Click handler ─────────────────────────────────────
  function onItemClick(item) {
    if (busy || endShown) return;
    if (item.el.classList.contains('used')) return;

    if (item.stepIdx === step) {
      applyItem(item);
    } else {
      wrongItem(item);
    }
  }

  // ── Wrong order feedback ──────────────────────────────
  function wrongItem(item) {
    // Shake – use centered variant if item is center-positioned
    item.el.classList.remove('shake', 'shakeCentered');
    void item.el.offsetWidth; // force reflow
    item.el.classList.add(item.centered ? 'shakeCentered' : 'shake');
    setTimeout(() => item.el.classList.remove('shake', 'shakeCentered'), 560);

    // Hint text
    if (hintTimer) clearTimeout(hintTimer);
    hintText.style.opacity = '1';
    hintTimer = setTimeout(() => { hintText.style.opacity = '0'; }, 1500);
  }

  // ── Correct item: fly to dog ──────────────────────────
  function applyItem(item) {
    busy = true;
    flyToDog(item, () => {
      // Equip overlay
      item.equip.style.opacity = '1';

      // Disable sand tile
      item.el.classList.add('used');

      // Checkmark badge
      item.el.querySelector('.checkmark').classList.add('shown');

      // Advance step & HUD
      step++;
      updateHUD();

      busy = false;

      if (step === 3) {
        setTimeout(completeAll, 420);
      }
    });
  }

  // ── Animate item flying to dog ────────────────────────
  function flyToDog(item, cb) {
    const fromRect = item.el.getBoundingClientRect();
    const dogRect  = dogContainer.getBoundingClientRect();

    const clone = document.createElement('img');
    clone.src = item.el.querySelector('img').src;
    const startX = fromRect.left + fromRect.width  / 2 - 36;
    const startY = fromRect.top  + fromRect.height / 2 - 36;
    clone.style.cssText = `
      position: fixed;
      width: 72px; height: 72px;
      object-fit: contain;
      pointer-events: none;
      z-index: 500;
      left: ${startX}px;
      top:  ${startY}px;
      transition:
        left  0.62s cubic-bezier(0.25, 0.46, 0.45, 0.94),
        top   0.62s cubic-bezier(0.25, 0.46, 0.45, 0.94),
        transform 0.62s ease,
        opacity   0.18s ease 0.52s;
    `;
    document.body.appendChild(clone);

    const targetX = dogRect.left + dogRect.width  / 2 - 36;
    const targetY = dogRect.top  + dogRect.height / 2 - 36;

    requestAnimationFrame(() => {
      requestAnimationFrame(() => {
        clone.style.left      = targetX + 'px';
        clone.style.top       = targetY + 'px';
        clone.style.transform = 'scale(0.5)';
        clone.style.opacity   = '0';
      });
    });

    setTimeout(() => {
      document.body.removeChild(clone);
      cb();
    }, 780);
  }

  // ── HUD update ────────────────────────────────────────
  function updateHUD() {
    progressText.textContent = `PREP: ${step} / 3`;
    progressFill.style.width = `${(step / 3) * 100}%`;
  }

  // ── All 3 done ────────────────────────────────────────
  function completeAll() {
    busy = true;

    // Remove sad cloud
    sadCloud.style.opacity = '0';

    // Stars
    fireStars();

    setTimeout(() => {
      // Dog crossfade
      dogSad.style.opacity   = '0';
      dogHappy.style.opacity = '1';

      setTimeout(moveDogToOcean, 850);
    }, 1050);
  }

  // ── Stars ─────────────────────────────────────────────
  function fireStars() {
    starBurst.innerHTML = '';
    const palette = ['#FFD700','#FF6B6B','#7ECEF6','#98FB98','#FF69B4','#FFA500'];
    const spots = [
      { l:  '8%', t: '50%' }, { l: '25%', t: '15%' }, { l: '50%', t: '55%' },
      { l: '72%', t: '10%' }, { l: '92%', t: '48%' }, { l: '18%', t: '80%' },
      { l: '50%', t:  '0%' }, { l: '82%', t: '78%' },
    ];
    spots.forEach((pos, i) => {
      const s = document.createElement('div');
      s.className = 'star';
      const sz = 8 + (i % 4) * 3;
      s.style.cssText = `
        left: ${pos.l}; top: ${pos.t};
        width: ${sz}px; height: ${sz}px;
        background: ${palette[i % palette.length]};
        animation-delay: ${i * 0.09}s;
      `;
      starBurst.appendChild(s);
    });
    setTimeout(() => { starBurst.innerHTML = ''; }, 2200);
  }

  // ── Move dog to ocean ─────────────────────────────────
  function moveDogToOcean() {
    dogContainer.style.transition = 'bottom 1.5s cubic-bezier(0.4, 0, 0.2, 1)';
    dogContainer.style.bottom = '56%';

    setTimeout(() => {
      showSplash();
      setTimeout(() => {
        // Bob forever
        dogContainer.style.transition = 'none';
        dogContainer.style.animation  = 'dogBob 1.6s ease-in-out infinite';
        showEndScreen();
      }, 850);
    }, 1550);
  }

  // ── Splash effect ─────────────────────────────────────
  function showSplash() {
    const dogRect = dogContainer.getBoundingClientRect();
    const cx = dogRect.left + dogRect.width / 2;
    const cy = dogRect.bottom - dogRect.height * 0.25;

    splash.style.cssText = `
      position: fixed;
      left: ${cx - 60}px;
      top:  ${cy - 30}px;
      width: 120px;
      height: 60px;
      pointer-events: none;
      z-index: 160;
      opacity: 1;
    `;
    splash.innerHTML = '';

    const drops = [
      { l:'10%', t:'40%', s:18, d:0    },
      { l:'30%', t:'0%',  s:25, d:0.07 },
      { l:'50%', t:'50%', s:20, d:0.04 },
      { l:'65%', t:'5%',  s:30, d:0.1  },
      { l:'82%', t:'35%', s:16, d:0.03 },
      { l:'45%', t:'-20%',s:22, d:0.06 },
    ];
    drops.forEach(d => {
      const dr = document.createElement('div');
      dr.className = 'splash-drop';
      dr.style.cssText = `
        left: ${d.l}; top: ${d.t};
        width: ${d.s}px; height: ${d.s}px;
        animation-delay: ${d.d}s;
      `;
      splash.appendChild(dr);
    });

    setTimeout(() => { splash.innerHTML = ''; }, 1300);
  }

  // ── End screen ────────────────────────────────────────
  function showEndScreen() {
    endShown = true;
    busy     = false;
    endOverlay.classList.add('visible');
  }

  // ── Restart ───────────────────────────────────────────
  function restart() {
    // Reset flags
    step     = 0;
    busy     = false;
    endShown = false;

    // HUD
    updateHUD();

    // Hide overlay
    endOverlay.classList.remove('visible');

    // Dog: reset position + images
    dogContainer.style.transition = 'none';
    dogContainer.style.animation  = 'none';
    dogContainer.style.bottom     = '22%';
    dogContainer.style.left       = '50%';
    dogSad.style.opacity   = '1';
    dogHappy.style.opacity = '0';

    // Sad cloud back
    sadCloud.style.opacity = '1';

    // Stars gone
    starBurst.innerHTML = '';

    // Hint gone
    if (hintTimer) clearTimeout(hintTimer);
    hintText.style.opacity = '0';

    // Splash gone
    splash.innerHTML = '';

    // Reset all items
    ITEMS.forEach(item => {
      item.el.classList.remove('used', 'shake', 'shakeCentered');
      item.el.querySelector('.checkmark').classList.remove('shown');
      item.equip.style.opacity = '0';
    });
  }

  init();

}());
</script>
</body>
</html>
